{% extends "base.html" %}
{% block title %}Manage Assignment â€” {{ block.super }}{% endblock %}
{% block content %}
  <section class="panel">
    <div class="panel-heading">
      <h3>Manage {{ assignment.get_type_display }} - {{ assignment.title }}</h3>
      <div class="action-right">
        <span class="muted">{% if assignment.is_published %}Published{% else %}Draft{% endif %}</span>
        <form method="post" action="" class="inline" novalidate>
          {% csrf_token %}
          {% if not assignment.is_published %}
            <input type="hidden" name="action" value="publish" />
            <button type="submit" class="btn" formnovalidate>Publish</button>
          {% else %}
            <input type="hidden" name="action" value="unpublish" />
            <button type="submit" class="btn-secondary" {% if locked %}disabled{% endif %} formnovalidate data-confirm="Unpublish this assignment? Students won't be able to submit until republished.">Unpublish</button>
          {% endif %}
        </form>
        <a href="/assignments/{{ assignment.id }}/attempts/" class="btn-secondary">Attempts</a>
        <a href="/assignments/course/{{ assignment.course.id }}/" class="btn-secondary">Back to assignments</a>
      </div>
    </div>
    <form method="post" action="" class="mb-2">
      {% csrf_token %}
      <div class="kv">
        <label for="id_title">Title</label>
        {{ meta_form.title }}
        {{ meta_form.title.errors }}
        <label for="id_instructions">Instructions</label>
        {{ meta_form.instructions }}
        {{ meta_form.instructions.errors }}
        <label for="id_available_from">Available</label>
        <div class="answer-row">
          {{ meta_form.available_from }}
          <button type="submit" name="action" value="set_available_now" class="btn-link" formnovalidate>Now</button>
        </div>
        {{ meta_form.available_from.errors }}
        <label for="id_deadline">Deadline</label>
        <div class="answer-row">
          {{ meta_form.deadline }}
          <select name="deadline_delta" class="input-sm">
            <option value="1d">One day</option>
            <option value="3d">Three days</option>
            <option value="1w">One week</option>
            <option value="2w">Two weeks</option>
            <option value="1m">One month</option>
            <option value="3m">Three months</option>
          </select>
          <button type="submit" name="action" value="set_deadline_delta" class="btn-link" formnovalidate>Set</button>
        </div>
        {{ meta_form.deadline.errors }}
        <label for="id_attempts_allowed">Attempts</label>
        {{ meta_form.attempts_allowed }}
        {{ meta_form.attempts_allowed.errors }}
        <div></div>
        <p class="muted">At least 1; cannot be less than attempts already used.</p>
        <label for="id_max_marks">Max marks</label>
        {{ meta_form.max_marks }}
        {{ meta_form.max_marks.errors }}
        <div></div>
        <p class="muted">Default 100. Used in course percentage.</p>
      </div>
      <button type="submit" name="action" value="update_meta" class="btn-secondary">Save details</button>
    </form>
    <p class="muted">All times in Mountain Time.</p>
    

    {% if assignment.type == 'exam' %}
      {% if locked %}
        <p class="muted">Assignment is locked (attempts exist). You can no longer edit questions.</p>
      {% endif %}
      <h4>Questions</h4>
      <ul>
        {% for q in assignment.questions.all %}
          <li>
            <div class="answer-row">
              <div><strong>Q{{ q.order }}.</strong> {{ q.text }}</div>
              {% if not locked %}
              <form method="post" action="" class="inline">
                {% csrf_token %}
                <input type="hidden" name="action" value="update_question" />
                <input type="hidden" name="question_id" value="{{ q.id }}" />
                <input type="text" name="text" value="{{ q.text }}" class="input-sm w-50" aria-label="Edit question" />
                <button type="submit" class="btn-secondary">Save</button>
              </form>
              {% endif %}
            </div>
            {% if not locked %}
            <form method="post" action="" class="inline" data-confirm="Delete this question?">
              {% csrf_token %}
              <input type="hidden" name="action" value="delete_question" />
              <input type="hidden" name="question_id" value="{{ q.id }}" />
              <button type="submit" class="btn-link">Delete</button>
            </form>
            {% endif %}
          </li>
        {% empty %}
          <li class="muted">No questions yet.</li>
        {% endfor %}
      </ul>
      {% if not locked %}
      <h4>Add a question</h4>
      <form method="post" action="">
        {% csrf_token %}
        <input type="hidden" name="action" value="add_question" />
        <div class="kv">
          <label for="id_text">Question</label>
          {{ q_form.text }}
        </div>
        <button type="submit" class="btn">Add question</button>
      </form>
      {% endif %}
    {% endif %}
  </section>
{% endblock %}

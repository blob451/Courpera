{% extends "base.html" %}
{% block title %}Courses — {{ block.super }}{% endblock %}
{% block content %}
  <section class="panel">
    <h2>Courses</h2>
    {% if messages %}
      <ul>
        {% for message in messages %}
          <li class="muted">{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}
    {% if request.user.is_authenticated and role == 'teacher' %}
      <p><a href="/courses/create/">Create a course</a></p>
    {% endif %}
    <ul>
      {% for c in courses %}
        <li>
          <strong><a href="/courses/{{ c.id }}/">{{ c.title }}</a></strong>
          <span class="muted">by {{ c.owner.username }}</span>
          {% if request.user.is_authenticated and role == 'student' %}
            {% if c.id in enrolled_ids %}
              — <span class="muted">Enrolled</span>
              <form method="post" action="/courses/{{ c.id }}/unenrol/" style="display:inline">
                {% csrf_token %}
                <button type="submit">Unenrol</button>
              </form>
            {% else %}
              <form method="post" action="/courses/{{ c.id }}/enrol/" style="display:inline">
                {% csrf_token %}
                <button type="submit">Enrol</button>
              </form>
            {% endif %}
          {% endif %}
        </li>
      {% empty %}
        <li>No courses yet.</li>
      {% endfor %}
    </ul>
  </section>
{% endblock %}

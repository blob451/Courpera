{% extends "base.html" %}
{% block title %}Courses — {{ block.super }}{% endblock %}
{% block content %}
  <section class="panel">
    <h2>Courses</h2>
    {% if role == 'student' %}
      <form method="get" action="/courses/" class="mb-2">
        <label for="q" class="sr-only">Search courses</label>
        <input id="q" name="q" type="search" value="{{ q|default:'' }}" placeholder="Search courses…" class="input" />
        <button type="submit" class="btn">Search</button>
      </form>
    {% endif %}
    {% if request.user.is_authenticated and role == 'teacher' %}
      <p><a class="btn" href="/courses/create/">Create a course</a></p>
    {% endif %}
    <div class="card-grid">
      {% for c in courses %}
      <article class="card">
        {% if request.user.is_authenticated and role == 'student' and c.id in enrolled_ids %}
          <span class="badge card-status">Enrolled</span>
        {% endif %}
        <h3><a href="/courses/{{ c.id }}/">{{ c.title }}</a></h3>
        <div class="meta">by {{ c.owner.username }}</div>
        <div class="actions">
          <a class="btn btn-secondary" href="/courses/{{ c.id }}/">View</a>
          {% if request.user.is_authenticated and role == 'student' %}
            {% if c.id in enrolled_ids %}
              <form method="post" action="/courses/{{ c.id }}/unenrol/" class="inline">
                {% csrf_token %}
                <button type="submit" class="btn">Unenrol</button>
              </form>
            {% else %}
              <form method="post" action="/courses/{{ c.id }}/enrol/" class="inline">
                {% csrf_token %}
                <button type="submit" class="btn">Enrol</button>
              </form>
            {% endif %}
          {% endif %}
        </div>
      </article>
      {% empty %}
      <div class="muted">No courses yet.</div>
      {% endfor %}
    </div>
  </section>
{% endblock %}

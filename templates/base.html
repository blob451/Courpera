<!doctype html>
<html lang="en-CA">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Courpera{% endblock %}</title>
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="alternate icon" href="/favicon.ico">
    <link rel="stylesheet" href="/static/css/base.css">
  </head>
  <body>
    <a class="sr-only" href="#main">Skip to content</a>
    <header role="banner">
      <h1><a href="/">Courpera</a></h1>
      <nav aria-label="Primary" style="position:relative; display:flex; gap:0.75rem; align-items:center; flex-wrap:wrap">
        {% if request.user.is_authenticated %}
          <a href="/accounts/home/">Home</a>
          <a href="/courses/">Courses</a>
          {% if request.user.profile and request.user.profile.role == 'teacher' %}
          <form method="get" action="/accounts/search/" style="display:inline">
            <label for="hdrq" class="sr-only">Search users</label>
            <input id="hdrq" name="q" type="search" placeholder="Search usersâ€¦" style="padding:0.2rem 0.4rem" />
          </form>
          {% endif %}
          <button id="notifBtn" class="link-btn" type="button">Notifications <span id="notifBadge" class="muted"></span></button>
          <div id="notifPanel" style="display:none; position:absolute; background:#fff; border:1px solid #ddd; padding:.5rem; border-radius:6px; max-width:360px; z-index:1000; right:0;">
            <strong>Recent</strong>
            <ul id="notifList" style="margin:.5rem 0; padding-left:1rem"></ul>
            <div>
              <form method="post" action="/activity/notifications/mark-all-read/">
                {% csrf_token %}
                <button type="submit" class="link-btn">Mark all read</button>
                <a href="/activity/notifications/">View all</a>
              </form>
            </div>
          </div>
          <form method="post" action="/accounts/logout/" style="display:inline">
            {% csrf_token %}
            <button type="submit" class="link-btn">Sign out</button>
          </form>
        {% else %}
          <a href="/courses/">Courses</a>
          <a href="/accounts/login/">Sign in</a>
          <a href="/accounts/register/">Register</a>
        {% endif %}
      </nav>
    </header>
    {% if messages %}
    <div class="panel" aria-live="polite" style="max-width:960px;margin:0 auto 1rem auto">
      <ul style="margin:0;padding-left:1.2rem">
        {% for message in messages %}
          <li class="muted">{{ message }}</li>
          {% if 'error' in message.tags %}
            <script>try{ alert('{{ message|escapejs }}'); }catch(e){}</script>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
    {% endif %}
    <main id="main" role="main">
      {% block content %}{% endblock %}
    </main>
  <script defer src="/static/js/app.js"></script>
  </body>
  <!-- Stage 1: keep markup simple and semantic; more structure follows -->
</html>
